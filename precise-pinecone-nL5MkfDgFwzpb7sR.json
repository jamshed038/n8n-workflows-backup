{"createdAt":"2025-07-29T07:04:54.495Z","updatedAt":"2025-07-31T07:13:12.000Z","id":"nL5MkfDgFwzpb7sR","name":"Precise-Pinecone","active":false,"isArchived":false,"nodes":[{"parameters":{"method":"POST","url":"https://api.pinecone.io/indexes","authentication":"predefinedCredentialType","nodeCredentialType":"pineconeApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/json"},{"name":"X-Pinecone-API-Version","value":"2025-04"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"name\": \"{{ $json.index }}\",\n  \"vector_type\": \"dense\",\n  \"dimension\": 1536,\n  \"metric\": \"cosine\",\n  \"embed\": {\n    \"model\": \"text-embedding-3-small\"\n  },\n  \"spec\": {\n    \"serverless\": {\n      \"cloud\": \"aws\",\n      \"region\": \"us-east-1\"\n    }\n  },\n  \"tags\":{\n     \"embedding_model\": \"text-embedding-3-small\"\n  },\n  \"deletion_protection\": \"disabled\"\n}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1424,960],"id":"666e9e25-f1fc-40f4-910c-58e589ec407b","name":"Create Project Index","credentials":{"httpHeaderAuth":{"id":"hih1wtLGqreZJ1wq","name":"Jamshed's  Relevance AI"},"pineconeApi":{"id":"INUAJbteVgOCaL5J","name":"Jamshed's PineconeApi account "}},"disabled":true},{"parameters":{"assignments":{"assignments":[{"id":"be9420e4-2b6b-4085-8224-00c208b4bf37","name":"internal_1","value":"Program-Overview","type":"string"},{"id":"ab8ec7ef-15a1-40c7-8221-e3724a8e5ef7","name":"internal_2","value":"Program-Budget-Template","type":"string"},{"id":"daad5100-69db-4208-a7a4-9248228f9082","name":"internal_3","value":"Program-Calendar","type":"string"},{"id":"c3be13a7-7fa2-4586-adad-50a2bbd52376","name":"internal_4","value":"Monitoring-Evaluation-Plan","type":"string"},{"id":"ea29846c-0077-4636-a92d-13bf7a82a0d7","name":"internal_5","value":"Program-Logic-Model","type":"string"},{"id":"73f6f95a-4ded-45a9-90b8-973adfc40077","name":"internal_6","value":"Program-Operations-Manual","type":"string"},{"id":"cac395f5-c0ff-469e-b40d-5d8e86349d58","name":"internal_7","value":"Program-Management-SOPs","type":"string"},{"id":"2850fed1-188c-4156-be6b-ea7cdd309a8b","name":"internal_8","value":"Roles-Responsibilities-Matrix","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1424,512],"id":"8c52567b-0c8b-47c8-8d84-182ae62a231f","name":"INTERNAL DOCUMENTS","disabled":true},{"parameters":{"assignments":{"assignments":[{"id":"be9420e4-2b6b-4085-8224-00c208b4bf37","name":"participant_1","value":"Participant-Handbook","type":"string"},{"id":"7e6d012b-1150-4bf9-ab9a-0c95eb3bc476","name":"participant_2","value":"Policies-Procedures-Manual","type":"string"},{"id":"a4592be4-2938-4927-9a3a-041cede2e549","name":"participant_3","value":"Code-of-Conduct","type":"string"},{"id":"9e4ea495-ea06-4e80-83a0-61782bbcec95","name":"participant_4","value":"Media-Release-Form","type":"string"},{"id":"bb0194a2-b9b4-40a2-91df-c32386fb4282","name":"participant_5","value":"Waiver-Liability-Release","type":"string"},{"id":"01cec5da-eb84-4002-a1fc-b971df5ee536","name":"participant_6","value":"Certificate-of-Completion","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1424,288],"id":"bd48164c-3218-4756-8bdf-547551079696","name":"PARTICIPANT-FACING DOCUMENTS","disabled":true},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1200,1392],"id":"4e5d47ab-4d80-47bd-834a-4064e166d18d","name":"Download file","credentials":{"googleDriveOAuth2Api":{"id":"RO1XYx2xtjvQILlF","name":"Jamshed's Drive account"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"111PJQpgdXVWe3aLGpGdJ4ciAfM8uZkX5","mode":"list","cachedResultName":"internal","cachedResultUrl":"https://drive.google.com/drive/folders/111PJQpgdXVWe3aLGpGdJ4ciAfM8uZkX5"},"event":"fileCreated","options":{}},"type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[-1424,736],"id":"5afbfbf5-db86-40b3-a3b0-600e49195ab3","name":"Google Drive Trigger","credentials":{"googleDriveOAuth2Api":{"id":"RO1XYx2xtjvQILlF","name":"Jamshed's Drive account"}},"disabled":true},{"parameters":{"assignments":{"assignments":[{"id":"27c3ea02-d075-4110-9d75-c45b1758bdae","name":"namespace","value":"={{ $json.fileName.replace(' ', '-') }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-752,1392],"id":"8880521c-b52a-4aac-9b51-a17cb2857a54","name":"Set Namespace"},{"parameters":{"jsCode":"return items.map(item => {\n  const binary = item.binary?.data;\n  return {\n    json: {\n      fileName: binary?.fileName.toLowerCase(),\n      mimeType: binary?.mimeType\n    },\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-976,1392],"id":"5f115c1e-b5bb-4d57-81c0-94e72333ccd1","name":"Get Filename"},{"parameters":{"model":"text-embedding-3-large","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-304,1408],"id":"f5789513-c380-4743-af1c-bf20dd4284dd","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"xVx0pwYla0RbJEUC","name":"Jamshed's OpenAi account"}}},{"parameters":{"dataType":"binary","textSplittingMode":"custom","options":{}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[-176,1408],"id":"39659b83-a49a-493c-98eb-0db90b8e17e2","name":"Default Data Loader"},{"parameters":{"chunkSize":500,"chunkOverlap":100,"options":{}},"type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","typeVersion":1,"position":[-80,1616],"id":"ac874704-ffd8-41d7-9403-4ef54bc6318b","name":"Recursive Character Text Splitter"},{"parameters":{"mode":"insert","pineconeIndex":{"__rl":true,"value":"clienttesting","mode":"list","cachedResultName":"clienttesting"},"options":{"clearNamespace":false,"pineconeNamespace":"={{ $node[\"Set Namespace\"].json[\"namespace\"] }}"}},"type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1.3,"position":[-288,1184],"id":"fd0a5f5d-74ac-4f65-88e8-3dea61380c85","name":"Pinecone Vector Store","credentials":{"pineconeApi":{"id":"INUAJbteVgOCaL5J","name":"Jamshed's PineconeApi account "}}},{"parameters":{"resource":"fileFolder","filter":{"folderId":{"__rl":true,"value":"111PJQpgdXVWe3aLGpGdJ4ciAfM8uZkX5","mode":"list","cachedResultName":"internal","cachedResultUrl":"https://drive.google.com/drive/folders/111PJQpgdXVWe3aLGpGdJ4ciAfM8uZkX5"}},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1424,1392],"id":"74e8018d-ca41-4c97-bccd-e10c59def8c2","name":"Search files and folders","credentials":{"googleDriveOAuth2Api":{"id":"RO1XYx2xtjvQILlF","name":"Jamshed's Drive account"}}},{"parameters":{"jsCode":"const items = $(\"Download file\").all();\n\nreturn items.map(item => {\n  const binaryData = item.binary?.data;\n\n  return {\n    json: {\n      fileName: item.binary?.data?.fileName,\n      mimeType: item.binary?.data?.mimeType,\n      fileSize: item.binary?.data?.fileSize,\n    },\n    binary: {\n      data: binaryData, // keeps the file attached for future steps\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-528,1392],"id":"c9e7a6b5-eda9-4864-a4ff-55de78b3b000","name":"Get The Downloaded Files"},{"parameters":{"content":"## Internal Documents","height":840,"width":2420,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1872,928],"id":"5214140f-645c-4168-8df2-5168515ef246","name":"Sticky Note"},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1200,2032],"id":"4ff4ea70-ab75-42e1-897a-5a0bc57b8f06","name":"Download file1","credentials":{"googleDriveOAuth2Api":{"id":"RO1XYx2xtjvQILlF","name":"Jamshed's Drive account"}}},{"parameters":{"assignments":{"assignments":[{"id":"27c3ea02-d075-4110-9d75-c45b1758bdae","name":"namespace","value":"={{ $json.fileName.replace(' ', '-') }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-752,2032],"id":"81c18cb4-1360-4025-9ae8-3ac01ccbb544","name":"Set Namespace1"},{"parameters":{"jsCode":"return items.map(item => {\n  const binary = item.binary?.data;\n  return {\n    json: {\n      fileName: binary?.fileName.toLowerCase(),\n      mimeType: binary?.mimeType\n    },\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-976,2032],"id":"8ef86be1-0b0b-441c-b59e-b2747094895c","name":"Get Filename1"},{"parameters":{"model":"text-embedding-3-large","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-304,2256],"id":"f1a6faab-0d56-4c8e-ae21-8d0e5435f6a9","name":"Embeddings OpenAI1","credentials":{"openAiApi":{"id":"xVx0pwYla0RbJEUC","name":"Jamshed's OpenAi account"}}},{"parameters":{"dataType":"binary","textSplittingMode":"custom","options":{}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[-176,2256],"id":"a62716fd-cf26-45a5-9a82-f1e773e9da8c","name":"Default Data Loader1"},{"parameters":{"chunkSize":500,"chunkOverlap":100,"options":{}},"type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","typeVersion":1,"position":[-80,2464],"id":"e74bae65-ecd5-4671-91d8-86aba62241d3","name":"Recursive Character Text Splitter1"},{"parameters":{"mode":"insert","pineconeIndex":{"__rl":true,"value":"clienttesting","mode":"list","cachedResultName":"clienttesting"},"options":{"clearNamespace":false,"pineconeNamespace":"={{ $node[\"Set Namespace1\"].json[\"namespace\"] }}"}},"type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1.3,"position":[-288,2032],"id":"b4d77433-10a3-4422-8bb2-5e5a1155e0cb","name":"Pinecone Vector Store1","credentials":{"pineconeApi":{"id":"INUAJbteVgOCaL5J","name":"Jamshed's PineconeApi account "}}},{"parameters":{"resource":"fileFolder","filter":{"folderId":{"__rl":true,"value":"1BPWSY6AQCwHlNW-6my-lglIk8RLE6MSx","mode":"list","cachedResultName":"participant-facing","cachedResultUrl":"https://drive.google.com/drive/folders/1BPWSY6AQCwHlNW-6my-lglIk8RLE6MSx"}},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1424,2032],"id":"8a2264e0-edd5-4b9d-ab1f-1f812efbc843","name":"Search files and folders1","credentials":{"googleDriveOAuth2Api":{"id":"RO1XYx2xtjvQILlF","name":"Jamshed's Drive account"}}},{"parameters":{"jsCode":"const items = $(\"Download file1\").all();\n\nreturn items.map(item => {\n  const binaryData = item.binary?.data;\n\n  return {\n    json: {\n      fileName: item.binary?.data?.fileName,\n      mimeType: item.binary?.data?.mimeType,\n      fileSize: item.binary?.data?.fileSize,\n    },\n    binary: {\n      data: binaryData, // keeps the file attached for future steps\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-528,2032],"id":"09b48247-115a-46c7-913d-df94fcf671cb","name":"Get The Downloaded Files1"},{"parameters":{"content":"## Participant Facing Documents","height":840,"width":2420,"color":7},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1872,1776],"id":"dc997b6c-2220-4636-83d5-c73faa66b57a","name":"Sticky Note1"},{"parameters":{"model":{"__rl":true,"value":"gpt-4","mode":"list","cachedResultName":"gpt-4"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-752,3456],"id":"12a4bc7e-c3e8-4c8e-8761-54779de1fef3","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"xVx0pwYla0RbJEUC","name":"Jamshed's OpenAi account"}}},{"parameters":{"formTitle":"SOP","formFields":{"values":[{"fieldLabel":"Organization Name","placeholder":"Future Builders Initiative","requiredField":true},{"fieldLabel":"Mission Statement","placeholder":"Empower underrepresented youth through skills training, mentorship, and real-world experiences.","requiredField":true},{"fieldLabel":"Vision Statement","placeholder":"A future where every young person has access to the tools, networks, and opportunities to thrive.","requiredField":true},{"fieldLabel":"Organization Type","placeholder":"Youth Development","requiredField":true},{"fieldLabel":"Geographic Area Served","placeholder":"Greater Chicago Area","requiredField":true},{"fieldLabel":"Program Name","placeholder":"Code & Create Bootcamp","requiredField":true},{"fieldLabel":"Description","placeholder":"An 8-week immersive program teaching web development and design thinking to high school students.","requiredField":true},{"fieldLabel":"Program Type","placeholder":"Training","requiredField":true},{"fieldLabel":"Program Objectives","placeholder":"- Teach foundational web development skills (HTML, CSS, JavaScript)\n\n- Foster creativity and problem-solving\n\n- Build confidence through portfolio projects","requiredField":true},{"fieldLabel":"Duration","placeholder":"8 weeks","requiredField":true},{"fieldLabel":"Frequency","placeholder":"Weekly (Saturday sessions)","requiredField":true},{"fieldLabel":"Key Activities & Services","placeholder":"- Hands-on coding workshops\n\n- Guest speakers from the tech industry\n\n- Project-based learning\n\n- Career panel and demo day","requiredField":true},{"fieldLabel":"Target Audience","placeholder":"High school juniors and seniors from underserved communities","requiredField":true},{"fieldLabel":"Number of Staff","placeholder":"4","requiredField":true},{"fieldLabel":"Staff Roles","placeholder":"Program Manager, Lead Instructor, Teaching Assistant, Guest Mentor","requiredField":true},{"fieldLabel":"Max Participants","placeholder":"25","requiredField":true},{"fieldLabel":"Funding Source(s)","placeholder":"City Innovation Grant, Local Tech Sponsor","requiredField":true},{"fieldLabel":"Evaluation/Impact Strategy","placeholder":"- Pre/post coding assessments\n\n- Weekly reflection forms\n\n- End-of-program project demos","requiredField":true},{"fieldLabel":"Top 3 Priorities or Challenges","placeholder":"- Consistent attendance\n\n- Access to laptops/internet\n\n- Keeping students engaged in hybrid format","requiredField":true}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-1424,2688],"id":"4b20cc38-22eb-425d-9859-375f22a0665e","name":"On form submission","webhookId":"4dd44224-c76d-4834-a15d-bdff17180b6b","disabled":true},{"parameters":{"jsCode":"const output = $json[\"output\"];\n\n// Remove any unnecessary \"---\" or blank lines\nconst cleanOutput = output.replace(/---/g, '').trim();\n\n// Define each field with regex\nconst extractField = (label) => {\n  const regex = new RegExp(`${label}:\\\\s*([\\\\s\\\\S]*?)(?=\\\\n[A-Z][a-zA-Z &]+ Notes:|$)`, 'i');\n  const match = cleanOutput.match(regex);\n  return match ? match[1].trim() : '';\n};\n\nreturn [\n  {\n    json: {\n      \"Program Name\": extractField(\"Program Name\"),\n      \"Document Type\": extractField(\"Document Type\"),\n      \"Organization Name\": extractField(\"Organization Name\"),\n      \"Weekly Planning Notes\": extractField(\"Weekly Planning Notes\"),\n      \"Session Delivery Notes\": extractField(\"Session Delivery Notes\"),\n      \"Monitoring & Evaluation Notes\": extractField(\"Monitoring & Evaluation Notes\"),\n      \"Reporting Notes\": extractField(\"Reporting Notes\")\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-752,2912],"id":"8795cf73-4c59-42b9-bafe-389067076055","name":"Code1"},{"parameters":{"jsCode":"const item = $json;\n\n// Format each field into a readable paragraph\nconst output = `\nProgram Name: ${item[\"Program Name\"]}\nDocument Type: ${item[\"Document Type\"]}\nOrganization Name: ${item[\"Organization Name\"]}\n\nWeekly Planning Notes:\n${item[\"Weekly Planning Notes\"]}\n\nSession Delivery Notes:\n${item[\"Session Delivery Notes\"]}\n\nMonitoring & Evaluation Notes:\n${item[\"Monitoring & Evaluation Notes\"]}\n\nReporting Notes:\n${item[\"Reporting Notes\"]}\n`.trim();\n\nreturn [{ json: { output } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1424,2464],"id":"1cdb947c-5e57-4260-917c-1e5dc4a0c062","name":"Code2"},{"parameters":{"jsCode":"const rawOutput = $json[\"output\"];\n\n// Remove triple backticks and optional \"html\" language identifier\nconst cleanedHtml = rawOutput\n  .replace(/^```html\\s*/i, '')   // Remove ```html at the start\n  .replace(/```$/, '');          // Remove closing ```\n\nreturn [\n  {\n    json: {\n      html: cleanedHtml\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1424,2912],"id":"9be7254c-5b18-42c1-9946-f969810e837a","name":"Code3"},{"parameters":{"method":"POST","url":"https://v2.convertapi.com/convert/html/to/docx","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer MSRRE6uQao9yWEYpeCk6RN0TTG0tNL8z"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"StoreFile","value":"true"},{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"=data"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-976,2912],"id":"2db29cba-148c-4121-aa82-5ad0a2868d4c","name":"HTTP Request"},{"parameters":{"jsCode":"// Load HTML content from previous node \"Code3\"\nconst htmlContent = $input.item.json.html;\n\n// Create a Buffer (you must use Buffer global inside n8n Code node)\nconst binaryData = Buffer.from(htmlContent, 'utf-8');\n\nreturn [\n  {\n    binary: {\n      data: {\n        data: binaryData,\n        mimeType: 'text/html',\n        fileName: 'SOP-WorkReady.html',\n      }\n    },\n    json: {},\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1200,2912],"id":"410870da-1efb-4dbd-bd74-f11235b9b529","name":"Code4"},{"parameters":{"options":{"systemMessage":"=You are an expert operations consultant creating Standard Operating Procedures (SOPs) for nonprofit or community-based programs.\n\nUse the following form data to generate **Program-Specific SOPs** in a clear, professional tone, using the following 4 key sections:\n\n---\n\n### 1. Weekly Planning & Scheduling\n- Confirm session times, locations, and instructors.\n- Review prior weekâ€™s attendance and issues.\n- Send reminders to participants and facilitators.\n\n### 2. Program Delivery\n- Start sessions with check-ins.\n- Log attendance and session notes.\n- Collect facilitator feedback.\n\n### 3. Monitoring & Evaluation\n- Administer pre/post surveys.\n- Capture KPI data weekly.\n- Flag disengaged participants.\n\n### 4. Reporting\n- Submit weekly summaries to Program Manager.\n- Monthly reports for board/funders.\n- Debrief sessions at program close.\n\n---\n\n### ðŸ“‹ **Intake Data**\n**Organization Name:** {{ $json.chatInput.organization.organizationName }}  \n**Mission Statement:** {{ $json.chatInput.organization.missionStatement }}  \n**Vision Statement:** {{ $json.chatInput.organization.visionStatement }}  \n**Organization Type:** {{ $json.chatInput.organization.organizationType }}  \n**Geographic Area Served:** {{ $json.chatInput.organization.geographicAreaServed }}\n\n---\n\n### ðŸ“Œ **Program Information**\n**Program Name:** {{ $json.chatInput.programs.programName }}  \n**Description:** {{ $json.chatInput.programs.description }}  \n**Program Type:** {{ $json.chatInput.programs.programType }}  \n**Program Objectives:** {{ $json.chatInput.programs.programObjectives }}  \n**Duration:** {{ $json.chatInput.programs.duration }}  \n**Frequency:** {{ $json.chatInput.programs.frequency }}  \n**Key Activities & Services:** {{ $json.chatInput.programs.keyActivitiesAndServices }}  \n**Target Audience:** {{ $json.chatInput.programs.targetAudience }}  \n**Number of Staff:** {{ $json.chatInput.programs.numberOfStaff }}  \n**Staff Roles:** {{ $json.chatInput.programs.staffRoles }}  \n**Max Participants:** {{ $json.chatInput.programs.maxParticipants }}  \n**Funding Source(s):** {{ $json.chatInput.programs.fundingSources }}  \n**Evaluation/Impact Strategy:** {{ $json.chatInput.programs.evaluationImpactStrategy }}  \n**Top 3 Priorities or Challenges:** {{ $json.chatInput.programs.topPrioritiesOrChallenges }}\n\n---\n\nPlease tailor the SOP sections to the above program details. Include program-specific examples where possible, and use bulleted formatting.\n\nYour output should be structured in Markdown with headers, bolding, and appropriate spacing.\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-752,3232],"id":"78d4034d-a57b-4700-b6e1-2a3c96d74086","name":"SOP Agent"},{"parameters":{"mode":"raw","jsonOutput":"{\n  \"organization\": {\n    \"organizationName\": \"Future Builders Initiative\",\n    \"missionStatement\": \"Empower underrepresented youth through skills training, mentorship, and real-world experiences.\",\n    \"visionStatement\": \"A future where every young person has access to the tools, networks, and opportunities to thrive.\",\n    \"organizationType\": \"Youth Development\",\n    \"geographicAreaServed\": \"Greater Chicago Area\"\n  },\n  \"programs\": \n    {\n      \"programName\": \"Code & Create Bootcamp\",\n      \"description\": \"An 8-week immersive program teaching web development and design thinking to high school students.\",\n      \"programType\": \"Training\",\n      \"programObjectives\": [\n        \"Teach foundational web development skills (HTML, CSS, JavaScript)\",\n        \"Foster creativity and problem-solving\",\n        \"Build confidence through portfolio projects\"\n      ],\n      \"duration\": \"8 weeks\",\n      \"frequency\": \"Weekly (Saturday sessions)\",\n      \"keyActivitiesAndServices\": [\n        \"Hands-on coding workshops\",\n        \"Guest speakers from the tech industry\",\n        \"Project-based learning\",\n        \"Career panel and demo day\"\n      ],\n      \"targetAudience\": \"High school juniors and seniors from underserved communities\",\n      \"numberOfStaff\": 4,\n      \"staffRoles\": [\"Program Manager\", \"Lead Instructor\", \"Teaching Assistant\", \"Guest Mentor\"],\n      \"maxParticipants\": 25,\n      \"fundingSources\": [\"City Innovation Grant\", \"Local Tech Sponsor\"],\n      \"evaluationImpactStrategy\": [\n        \"Pre/post coding assessments\",\n        \"Weekly reflection forms\",\n        \"End-of-program project demos\"\n      ],\n      \"topPrioritiesOrChallenges\": [\n        \"Consistent attendance\",\n        \"Access to laptops/internet\",\n        \"Keeping students engaged in hybrid format\"\n      ]\n    }\n\n}\n","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1200,3248],"id":"57bdb440-2fbc-4047-988a-c422e976440c","name":"Edit Fields"},{"parameters":{"jsCode":"// Wrap each incoming item inside a `chatInput` key\nreturn items.map(item => {\n  return {\n    json: {\n      chatInput: item.json\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-976,3248],"id":"14589419-5d6c-4e18-960f-ad5ac7766787","name":"Code"},{"parameters":{"method":"POST","url":"https://www.googleapis.com/upload/drive/v3/files","authentication":"predefinedCredentialType","nodeCredentialType":"googleDriveOAuth2Api","sendQuery":true,"queryParameters":{"parameters":[{"name":"uploadType","value":"multipart"},{"name":"supportsAllDrives","value":"true"}]},"sendBody":true,"contentType":"raw","rawContentType":"multipart/related; boundary=divider","body":"={{ $json.rawData }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[320,3232],"id":"4b9e88e4-21f2-42e4-902f-e3b621c54473","name":"CreateGoogleDoc1","notesInFlow":true,"credentials":{"googleDriveOAuth2Api":{"id":"RO1XYx2xtjvQILlF","name":"Jamshed's Drive account"}}},{"parameters":{"assignments":{"assignments":[{"id":"e7ee03ac-13e3-4fca-a7bc-57c8fc56dc42","name":"document_name","value":"=SOP","type":"string"},{"id":"48a07ef2-ae46-4bfc-aa7e-d92a74ef46d6","name":"html_content","value":"={{ $json.data }}","type":"string"},{"id":"22b02fba-ba72-423a-b92f-1191a183a554","name":"drive_folder_id","value":"1ZctVqDaF-kTeyjlDrYdtjM6w9jiKkoUi","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-112,3232],"id":"18322330-1273-40f6-a4dc-a48d13f3a841","name":"set_fields","notesInFlow":true},{"parameters":{"mode":"markdownToHtml","markdown":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.markdown","typeVersion":1,"position":[-352,3232],"id":"dd541eb1-894b-465b-958d-a67b6e9d9ee6","name":"Markdown"},{"parameters":{"jsCode":"// Simple HTML to Google Drive converter with link preservation\nconst boundary = 'divider';\nconst docName = $input.first().json.document_name;\nconst folderId = $input.first().json.drive_folder_id;\nconst htmlContent = $input.first().json.html_content;\n\n// Process HTML to ensure links are preserved\nfunction preserveLinks(htmlContent) {\n    // Ensure all links have proper attributes for Google Drive\n    let processedHtml = htmlContent;\n    \n    // Fix any malformed or incomplete link tags\n    processedHtml = processedHtml.replace(/<a\\s+href=[\"']([^\"']+)[\"'][^>]*>(.*?)<\\/a>/gi, '<a href=\"$1\">$2</a>');\n    \n    // Ensure links have proper protocol\n    processedHtml = processedHtml.replace(/<a\\s+href=[\"'](?!https?:\\/\\/|mailto:|tel:)([^\"']+)[\"']>/gi, '<a href=\"https://$1\">');\n    \n    return processedHtml;\n}\n\nconst metadata = JSON.stringify({\n  name: docName,\n  mimeType: \"application/vnd.google-apps.document\",\n  parents: [folderId]\n});\n\n// Process the HTML content to preserve links\nconst processedHtmlContent = preserveLinks(htmlContent);\n\nconst htmlWithStyles = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    /* Add bottom margin to block elements for spacing */\n    p,\n    ul,\n    ol,\n    table,\n    h1,\n    h2,\n    h3,\n    h4,\n    h5,\n    h6 {\n      margin-bottom: 10pt;\n    }\n    h2 {\n      margin-top: 20pt;\n    }\n    /* Prevent margin collapse issues or excessive space inside lists */\n    li {\n       margin-bottom: 2pt; /* Optional: small space between list items */\n    }\n    /* Ensure links are styled properly for Google Drive */\n    a {\n      color: #1155cc;\n      text-decoration: underline;\n    }\n    /* Remove margin from the last child within common containers if needed */\n    /* This might be overly aggressive, test without it first */\n    /*\n    body > *:last-child,\n    li > *:last-child {\n       margin-bottom: 0;\n    }\n    */\n  </style>\n</head>\n<body>\n  ${processedHtmlContent}\n</body>\n</html>\n`;\n\n// Construct the body with literal \\r\\n ONLY\nlet body = `--${boundary}\\r\\n`;\nbody += `Content-Type: application/json; charset=UTF-8\\r\\n`;\nbody += `\\r\\n`; // Blank line\nbody += `${metadata}\\r\\n`;\nbody += `--${boundary}\\r\\n`;\nbody += `Content-Type: text/html\\r\\n`;\nbody += `\\r\\n`; // Blank line\nbody += `${htmlWithStyles}\\r\\n`; // Add the HTML content\nbody += `--${boundary}--\\r\\n`; // Final boundary\n\nreturn {\n  rawData: body \n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[96,3232],"id":"15655e54-3205-48a1-bc8e-585468787b26","name":"Prepare_Request"},{"parameters":{"model":{"__rl":true,"value":"gpt-4","mode":"list","cachedResultName":"gpt-4"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-976,3920],"id":"ccaccd87-205b-42f6-99e2-fc46b5378507","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"xVx0pwYla0RbJEUC","name":"Jamshed's OpenAi account"}}},{"parameters":{"mode":"raw","jsonOutput":"{\n  \"organization\": {\n    \"organizationName\": \"Future Builders Initiative\",\n    \"missionStatement\": \"Empower underrepresented youth through skills training, mentorship, and real-world experiences.\",\n    \"visionStatement\": \"A future where every young person has access to the tools, networks, and opportunities to thrive.\",\n    \"organizationType\": \"Youth Development\",\n    \"geographicAreaServed\": \"Greater Chicago Area\"\n  },\n  \"programs\": \n    {\n      \"programName\": \"Code & Create Bootcamp\",\n      \"description\": \"An 8-week immersive program teaching web development and design thinking to high school students.\",\n      \"programType\": \"Training\",\n      \"programObjectives\": [\n        \"Teach foundational web development skills (HTML, CSS, JavaScript)\",\n        \"Foster creativity and problem-solving\",\n        \"Build confidence through portfolio projects\"\n      ],\n      \"duration\": \"8 weeks\",\n      \"frequency\": \"Weekly (Saturday sessions)\",\n      \"keyActivitiesAndServices\": [\n        \"Hands-on coding workshops\",\n        \"Guest speakers from the tech industry\",\n        \"Project-based learning\",\n        \"Career panel and demo day\"\n      ],\n      \"targetAudience\": \"High school juniors and seniors from underserved communities\",\n      \"numberOfStaff\": 4,\n      \"staffRoles\": [\"Program Manager\", \"Lead Instructor\", \"Teaching Assistant\", \"Guest Mentor\"],\n      \"maxParticipants\": 25,\n      \"fundingSources\": [\"City Innovation Grant\", \"Local Tech Sponsor\"],\n      \"evaluationImpactStrategy\": [\n        \"Pre/post coding assessments\",\n        \"Weekly reflection forms\",\n        \"End-of-program project demos\"\n      ],\n      \"topPrioritiesOrChallenges\": [\n        \"Consistent attendance\",\n        \"Access to laptops/internet\",\n        \"Keeping students engaged in hybrid format\"\n      ]\n    }\n\n}\n","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1424,3680],"id":"8c053dcd-06ac-4506-b377-12631828a969","name":"Edit Fields1"},{"parameters":{"jsCode":"// Wrap each incoming item inside a `chatInput` key\nreturn items.map(item => {\n  return {\n    json: {\n      chatInput: item.json\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1200,3680],"id":"97546973-8b7d-4805-81b8-a7ab15e46056","name":"Code5"},{"parameters":{"method":"POST","url":"https://www.googleapis.com/upload/drive/v3/files","authentication":"predefinedCredentialType","nodeCredentialType":"googleDriveOAuth2Api","sendQuery":true,"queryParameters":{"parameters":[{"name":"uploadType","value":"multipart"},{"name":"supportsAllDrives","value":"true"}]},"sendBody":true,"contentType":"raw","rawContentType":"multipart/related; boundary=divider","body":"={{ $json.rawData }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[368,3680],"id":"cd5a4b14-4bcc-4dfb-9b68-0fa106eb02a5","name":"CreateGoogleDoc","notesInFlow":true,"credentials":{"googleDriveOAuth2Api":{"id":"RO1XYx2xtjvQILlF","name":"Jamshed's Drive account"}}},{"parameters":{"assignments":{"assignments":[{"id":"e7ee03ac-13e3-4fca-a7bc-57c8fc56dc42","name":"document_name","value":"=Roles & Responsibilities Matrix","type":"string"},{"id":"48a07ef2-ae46-4bfc-aa7e-d92a74ef46d6","name":"html_content","value":"={{ $json.html_output }}","type":"string"},{"id":"22b02fba-ba72-423a-b92f-1191a183a554","name":"drive_folder_id","value":"1ZctVqDaF-kTeyjlDrYdtjM6w9jiKkoUi","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-80,3680],"id":"37724209-c013-43e9-a84f-df4bdc12223b","name":"set_fields1","notesInFlow":true},{"parameters":{"mode":"markdownToHtml","markdown":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.markdown","typeVersion":1,"position":[-576,3680],"id":"32cf57d9-a82a-45f7-891a-ad6db1a9c707","name":"Markdown1"},{"parameters":{"jsCode":"// Simple HTML to Google Drive converter with link preservation\nconst boundary = 'divider';\nconst docName = $input.first().json.document_name;\nconst folderId = $input.first().json.drive_folder_id;\nconst htmlContent = $input.first().json.html_content;\n\n// Process HTML to ensure links are preserved\nfunction preserveLinks(htmlContent) {\n    // Ensure all links have proper attributes for Google Drive\n    let processedHtml = htmlContent;\n    \n    // Fix any malformed or incomplete link tags\n    processedHtml = processedHtml.replace(/<a\\s+href=[\"']([^\"']+)[\"'][^>]*>(.*?)<\\/a>/gi, '<a href=\"$1\">$2</a>');\n    \n    // Ensure links have proper protocol\n    processedHtml = processedHtml.replace(/<a\\s+href=[\"'](?!https?:\\/\\/|mailto:|tel:)([^\"']+)[\"']>/gi, '<a href=\"https://$1\">');\n    \n    return processedHtml;\n}\n\nconst metadata = JSON.stringify({\n  name: docName,\n  mimeType: \"application/vnd.google-apps.document\",\n  parents: [folderId]\n});\n\n// Process the HTML content to preserve links\nconst processedHtmlContent = preserveLinks(htmlContent);\n\nconst htmlWithStyles = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    /* Add bottom margin to block elements for spacing */\n    p,\n    ul,\n    ol,\n    table,\n    h1,\n    h2,\n    h3,\n    h4,\n    h5,\n    h6 {\n      margin-bottom: 10pt;\n    }\n    h2 {\n      margin-top: 20pt;\n    }\n    /* Prevent margin collapse issues or excessive space inside lists */\n    li {\n       margin-bottom: 2pt; /* Optional: small space between list items */\n    }\n    /* Ensure links are styled properly for Google Drive */\n    a {\n      color: #1155cc;\n      text-decoration: underline;\n    }\n    /* Remove margin from the last child within common containers if needed */\n    /* This might be overly aggressive, test without it first */\n    /*\n    body > *:last-child,\n    li > *:last-child {\n       margin-bottom: 0;\n    }\n    */\n  </style>\n</head>\n<body>\n  ${processedHtmlContent}\n</body>\n</html>\n`;\n\n// Construct the body with literal \\r\\n ONLY\nlet body = `--${boundary}\\r\\n`;\nbody += `Content-Type: application/json; charset=UTF-8\\r\\n`;\nbody += `\\r\\n`; // Blank line\nbody += `${metadata}\\r\\n`;\nbody += `--${boundary}\\r\\n`;\nbody += `Content-Type: text/html\\r\\n`;\nbody += `\\r\\n`; // Blank line\nbody += `${htmlWithStyles}\\r\\n`; // Add the HTML content\nbody += `--${boundary}--\\r\\n`; // Final boundary\n\nreturn {\n  rawData: body \n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[160,3680],"id":"8fdc9ec4-c2fc-4561-abfd-bcbde61227cd","name":"Prepare_Request1"},{"parameters":{"options":{"systemMessage":"=You are an expert in organizational structure and nonprofit operations.\n\nUsing the intake data below, generate a **Roles & Responsibilities Matrix** tailored to the program's team structure and size.\n\n---\n\n### ðŸ“Œ Instructions:\n- Output must be formatted in **Markdown**.\n- Use **section headers**, **bolded labels**, and proper **table formatting** with spacing.\n- If only roles are provided without full descriptions, infer appropriate responsibilities and reporting lines using standard nonprofit structure.\n- Follow the sample structure provided below to guide your format.\n\n---\n\n### ðŸ“ Intake Data\n\n**Program Name:** {{ $json.chatInput.programs.programName }}\n**Number of Staff:**  {{ $json.chatInput.programs.numberOfStaff }}\n**Staff Roles:** {{ $json.chatInput.programs.staffRoles }}\n**Organization Type:** {{ $json.chatInput.organization.organizationType }}\n**Program Type:** {{ $json.chatInput.programs.programType }}\n**Top Priorities or Challenges:** {{ $json.chatInput.programs.topPrioritiesOrChallenges }}\n\n---\n\n### ðŸ’¡ Sample Reference Structure\n\n| **Role**             | **Responsibility**                                                | **Reports To**           |\n|----------------------|-------------------------------------------------------------------|---------------------------|\n| Program Director      | Strategic oversight, budget approval, compliance                 | Executive Director        |\n| Program Manager       | Day-to-day operations, staff oversight, issue escalation         | Program Director          |\n| Program Coordinator   | Logistics, communication, documentation                          | Program Manager           |\n| Facilitator           | Deliver content, track outcomes, engage participants             | Program Manager           |\n| Volunteer Mentor      | Support participants, flag concerns                              | Program Coordinator       |\n\n---\n\n### âœ… Output Requirements\n\n- Start with a clear **Markdown header**: `## ðŸ‘¥ Roles & Responsibilities Matrix`\n- Use a **table** to list: `Role`, `Responsibility`, and `Reports To`\n- Ensure roles are aligned with the number of staff and program type\n- **Use bulleted lists** in table cells if multiple responsibilities apply\n- Be concise but clear\n\n---\n\nPlease generate the full matrix below.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-976,3680],"id":"c670f1b2-88d7-4560-9eb8-14c045cfd296","name":"Roles & Responsibilities Matrix Agent"},{"parameters":{"jsCode":"const markdown = $input.first().json.output;\n\n// Custom parser to convert a markdown table to a proper HTML table\nfunction markdownTableToHTML(md) {\n  const lines = md.trim().split('\\n');\n  const tableLines = lines.filter(line => line.trim().startsWith('|'));\n\n  if (tableLines.length < 2) return '<p>No valid table found</p>';\n\n  const headerCells = tableLines[0].split('|').slice(1, -1).map(cell => cell.trim());\n  const rows = tableLines.slice(2).map(line => \n    line.split('|').slice(1, -1).map(cell => cell.trim())\n  );\n\n  let html = '<table border=\"1\" cellpadding=\"6\" cellspacing=\"0\" style=\"border-collapse: collapse; width: 100%;\">';\n  html += '<thead><tr>' + headerCells.map(cell => `<th>${cell}</th>`).join('') + '</tr></thead>';\n  html += '<tbody>';\n  rows.forEach(row => {\n    html += '<tr>' + row.map(cell => `<td>${cell}</td>`).join('') + '</tr>';\n  });\n  html += '</tbody></table>';\n\n  return html;\n}\n\n// Remove the header outside the table\nconst headingMatch = markdown.match(/^##.+?\\n+/);\nconst heading = headingMatch ? headingMatch[0].trim() : '';\n\n// Convert the markdown table only\nconst tableHTML = markdownTableToHTML(markdown);\n\nreturn {\n  html_output: `<h2>${heading.replace(/^##\\s*/, '')}</h2>\\n${tableHTML}`\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-352,3680],"id":"6fd028ef-266f-457e-adc1-94abc4d5c7b5","name":"Code6"},{"parameters":{"model":{"__rl":true,"value":"gpt-4","mode":"list","cachedResultName":"gpt-4"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1632,6304],"id":"1f001535-e57b-488b-8e94-b7069d8b315c","name":"OpenAI Chat Model7","credentials":{"openAiApi":{"id":"xVx0pwYla0RbJEUC","name":"Jamshed's OpenAi account"}}},{"parameters":{"mode":"raw","jsonOutput":"{\n  \"organization\": {\n    \"organizationName\": \"Future Builders Initiative\",\n    \"missionStatement\": \"Empower underrepresented youth through skills training, mentorship, and real-world experiences.\",\n    \"visionStatement\": \"A future where every young person has access to the tools, networks, and opportunities to thrive.\",\n    \"organizationType\": \"Youth Development\",\n    \"geographicAreaServed\": \"Greater Chicago Area\"\n  },\n  \"programs\": \n    {\n      \"programName\": \"Code & Create Bootcamp\",\n      \"description\": \"An 8-week immersive program teaching web development and design thinking to high school students.\",\n      \"programType\": \"Training\",\n      \"programObjectives\": [\n        \"Teach foundational web development skills (HTML, CSS, JavaScript)\",\n        \"Foster creativity and problem-solving\",\n        \"Build confidence through portfolio projects\"\n      ],\n      \"duration\": \"8 weeks\",\n      \"frequency\": \"Weekly (Saturday sessions)\",\n      \"keyActivitiesAndServices\": [\n        \"Hands-on coding workshops\",\n        \"Guest speakers from the tech industry\",\n        \"Project-based learning\",\n        \"Career panel and demo day\"\n      ],\n      \"targetAudience\": \"High school juniors and seniors from underserved communities\",\n      \"numberOfStaff\": 4,\n      \"staffRoles\": [\"Program Manager\", \"Lead Instructor\", \"Teaching Assistant\", \"Guest Mentor\"],\n      \"maxParticipants\": 25,\n      \"fundingSources\": [\"City Innovation Grant\", \"Local Tech Sponsor\"],\n      \"evaluationImpactStrategy\": [\n        \"Pre/post coding assessments\",\n        \"Weekly reflection forms\",\n        \"End-of-program project demos\"\n      ],\n      \"topPrioritiesOrChallenges\": [\n        \"Consistent attendance\",\n        \"Access to laptops/internet\",\n        \"Keeping students engaged in hybrid format\"\n      ]\n    }\n\n}\n","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[96,5888],"id":"92d5cc24-0c34-4db5-9c8b-0b735a483cb4","name":"Sample Intake Data2"},{"parameters":{"jsCode":"// Wrap each incoming item inside a `chatInput` key\nreturn items.map(item => {\n  return {\n    json: {\n      chatInput: item.json\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[384,5888],"id":"eb6988db-140c-471a-9089-1292df71612e","name":"Wrap Chat Input2"},{"parameters":{"mode":"markdownToHtml","markdown":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.markdown","typeVersion":1,"position":[3024,6576],"id":"90470f88-767c-47b5-894a-6a66900ebf78","name":"Convert Markdown to HTML2"},{"parameters":{"assignments":{"assignments":[{"id":"e7ee03ac-13e3-4fca-a7bc-57c8fc56dc42","name":"document_name","value":"=Media Release Form","type":"string"},{"id":"48a07ef2-ae46-4bfc-aa7e-d92a74ef46d6","name":"html_content","value":"={{ $json.data }}","type":"string"},{"id":"22b02fba-ba72-423a-b92f-1191a183a554","name":"drive_folder_id","value":"1ZctVqDaF-kTeyjlDrYdtjM6w9jiKkoUi","type":"string"},{"id":"e7c1e5f1-531b-4c8f-8b69-7fe95af4e14e","name":"Organization Name","value":"={{ $('Sample Intake Data2').item.json.organization.organizationName }}","type":"string"},{"id":"b1b43e73-9aa1-45f0-994d-074fd7b19ccf","name":"Program Name","value":"={{ $('Sample Intake Data2').item.json.programs.programName }}","type":"string"},{"id":"e276adbc-d601-4864-bd82-025f104e44da","name":"Program Type","value":"={{ $('Sample Intake Data2').item.json.programs.programType }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3248,6576],"id":"c7174eb5-2f4e-46df-8e61-ed7086ab957f","name":"Set Document Metadata2","notesInFlow":true},{"parameters":{"jsCode":"// Simple HTML to Google Drive converter with link preservation\nconst boundary = 'divider';\nconst docName = $input.first().json.document_name;\nconst folderId = $input.first().json.drive_folder_id;\nconst htmlContent = $input.first().json.html_content;\n\n// Process HTML to ensure links are preserved\nfunction preserveLinks(htmlContent) {\n    // Ensure all links have proper attributes for Google Drive\n    let processedHtml = htmlContent;\n    \n    // Fix any malformed or incomplete link tags\n    processedHtml = processedHtml.replace(/<a\\s+href=[\"']([^\"']+)[\"'][^>]*>(.*?)<\\/a>/gi, '<a href=\"$1\">$2</a>');\n    \n    // Ensure links have proper protocol\n    processedHtml = processedHtml.replace(/<a\\s+href=[\"'](?!https?:\\/\\/|mailto:|tel:)([^\"']+)[\"']>/gi, '<a href=\"https://$1\">');\n    \n    return processedHtml;\n}\n\nconst metadata = JSON.stringify({\n  name: docName,\n  mimeType: \"application/vnd.google-apps.document\",\n  parents: [folderId]\n});\n\n// Process the HTML content to preserve links\nconst processedHtmlContent = preserveLinks(htmlContent);\n\nconst htmlWithStyles = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    /* Add bottom margin to block elements for spacing */\n    p,\n    ul,\n    ol,\n    table,\n    h1,\n    h2,\n    h3,\n    h4,\n    h5,\n    h6 {\n      margin-bottom: 10pt;\n    }\n    h2 {\n      margin-top: 20pt;\n    }\n    /* Prevent margin collapse issues or excessive space inside lists */\n    li {\n       margin-bottom: 2pt; /* Optional: small space between list items */\n    }\n    /* Ensure links are styled properly for Google Drive */\n    a {\n      color: #1155cc;\n      text-decoration: underline;\n    }\n    /* Remove margin from the last child within common containers if needed */\n    /* This might be overly aggressive, test without it first */\n    /*\n    body > *:last-child,\n    li > *:last-child {\n       margin-bottom: 0;\n    }\n    */\n  </style>\n</head>\n<body>\n  ${processedHtmlContent}\n</body>\n</html>\n`;\n\n// Construct the body with literal \\r\\n ONLY\nlet body = `--${boundary}\\r\\n`;\nbody += `Content-Type: application/json; charset=UTF-8\\r\\n`;\nbody += `\\r\\n`; // Blank line\nbody += `${metadata}\\r\\n`;\nbody += `--${boundary}\\r\\n`;\nbody += `Content-Type: text/html\\r\\n`;\nbody += `\\r\\n`; // Blank line\nbody += `${htmlWithStyles}\\r\\n`; // Add the HTML content\nbody += `--${boundary}--\\r\\n`; // Final boundary\n\nreturn {\n  rawData: body \n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3456,6576],"id":"10781e34-1653-4552-b105-dfec7347e59c","name":"Build Google Docs Request2"},{"parameters":{"method":"POST","url":"https://www.googleapis.com/upload/drive/v3/files","authentication":"predefinedCredentialType","nodeCredentialType":"googleDriveOAuth2Api","sendQuery":true,"queryParameters":{"parameters":[{"name":"uploadType","value":"multipart"},{"name":"supportsAllDrives","value":"true"}]},"sendBody":true,"contentType":"raw","rawContentType":"multipart/related; boundary=divider","body":"={{ $json.rawData }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[3664,6576],"id":"605292da-197f-4d12-89ca-b96bd8f89643","name":"Upload Google Doc2","notesInFlow":true,"credentials":{"googleDriveOAuth2Api":{"id":"RO1XYx2xtjvQILlF","name":"Jamshed's Drive account"}}},{"parameters":{"content":"\n\n# Media Release Form Generation Workflow\n","height":1776,"width":5152,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-512,5424],"typeVersion":1,"id":"0a8492d9-4fba-4765-bcbb-86213abde56e","name":"Sticky Note13"},{"parameters":{"content":"# Sample Intake Data:\t\n## Provides sample structured intake data for testing the AI agent.\n\t\n\n\n# Wrap Chat Input\t\t\n## Wraps the input data under a chatInput key so it matches the structure expected in the AI agent prompt.","height":1408,"width":1456},"type":"n8n-nodes-base.stickyNote","position":[-400,5568],"typeVersion":1,"id":"ac5efe0a-f780-49ed-9af3-97d6e6aebe56","name":"Sticky Note14"},{"parameters":{"content":"#  LangChain Memory & Code of Conduct Agent\n## Initializes memory context and configures the LangChain AI Agent.\n\n## Media Release Memory: Stores conversation memory using Postgres.\n\n## Media Release Agent: Central AI agent with strict system message for tool usage.\n\n## OpenAI Chat Model7: Assigned as the agentâ€™s core language model.\n\n# RAGTOOL â€“ Vector Retrieval Tool (Orange)\n  ##Retrieves nonprofit document references from Pinecone to ensure tone alignment.\n\n\n\n\n","height":1408,"width":1408,"color":5},"type":"n8n-nodes-base.stickyNote","position":[1136,5568],"typeVersion":1,"id":"6329a46d-e275-4129-b531-45811379aecb","name":"Sticky Note15"},{"parameters":{"content":"# Markdown to HTML \n## Converts markdown-format SOP into styled HTML for Google Drive compatibility.\n\n# Prepare Upload Fields \n## Sets file name, folder ID, and HTML content for Google Docs upload.\n\n# Multipart Builder \n## Formats HTML and metadata into multipart format for Drive upload with proper boundaries.\n\n# Upload to Google Docs \n## Uploads the formatted HTML to Google Drive as a new Google Doc inside a specific folder.\n\n#  Airtable Logging \n## Saves the generated documentâ€™s metadata and link in Airtable.\n","height":1408,"width":1664,"color":7},"type":"n8n-nodes-base.stickyNote","position":[2640,5568],"typeVersion":1,"id":"d2a9bb11-6618-4c34-8f3a-bf774f9b6137","name":"Sticky Note16"},{"parameters":{"operation":"create","base":{"__rl":true,"value":"appbVS4DumJR62W4h","mode":"list","cachedResultName":"Documents Data","cachedResultUrl":"https://airtable.com/appbVS4DumJR62W4h"},"table":{"__rl":true,"value":"tbl83tx2pwXkCPvSO","mode":"list","cachedResultName":"Table 1","cachedResultUrl":"https://airtable.com/appbVS4DumJR62W4h/tbl83tx2pwXkCPvSO"},"columns":{"mappingMode":"defineBelow","value":{"organizationName":"={{ $('Sample Intake Data2').item.json.organization.organizationName }}","missionStatement":"={{ $('Sample Intake Data2').item.json.organization.missionStatement }}","visionStatement":"={{ $('Sample Intake Data2').item.json.organization.visionStatement }}","organizationType":"={{ $('Sample Intake Data2').item.json.organization.organizationType }}","geographicAreaServed":"={{ $('Sample Intake Data2').item.json.organization.geographicAreaServed }}","programName":"={{ $('Sample Intake Data2').item.json.programs.programName }}","description":"={{ $('Sample Intake Data2').item.json.programs.description }}","programType":"={{ $('Sample Intake Data2').item.json.programs.programType }}","programObjectives":"={{ $('Sample Intake Data2').item.json.programs.programObjectives.join() }}","duration":"={{ $('Sample Intake Data2').item.json.programs.duration }}","frequency":"={{ $('Sample Intake Data2').item.json.programs.frequency }}","keyActivitiesAndServices":"={{ $('Sample Intake Data2').item.json.programs.keyActivitiesAndServices.join() }}","targetAudience":"={{ $('Sample Intake Data2').item.json.programs.targetAudience }}","numberOfStaff":"={{ $('Sample Intake Data2').item.json.programs.numberOfStaff }}","staffRoles":"={{ $('Sample Intake Data2').item.json.programs.staffRoles.join() }}","maxParticipants":"={{ $('Sample Intake Data2').item.json.programs.maxParticipants }}","fundingSources":"={{ $('Sample Intake Data2').item.json.programs.fundingSources.join() }}","evaluationImpactStrategy":"={{ $('Sample Intake Data2').item.json.programs.evaluationImpactStrategy.join() }}","topPrioritiesOrChallenges":"={{ $('Sample Intake Data2').item.json.programs.topPrioritiesOrChallenges.join() }}","Document Name":"={{ $json.name }}","Doc Link":"=https://docs.google.com/document/d/{{ $json.id }}/edit?tab=t.0 "},"matchingColumns":["id"],"schema":[{"id":"Document Name","displayName":"Document Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Doc Link","displayName":"Doc Link","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"organizationName","displayName":"organizationName","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"missionStatement","displayName":"missionStatement","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"visionStatement","displayName":"visionStatement","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"organizationType","displayName":"organizationType","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"geographicAreaServed","displayName":"geographicAreaServed","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"programName","displayName":"programName","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"description","displayName":"description","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"programType","displayName":"programType","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"programObjectives","displayName":"programObjectives","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"duration","displayName":"duration","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"frequency","displayName":"frequency","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"keyActivitiesAndServices","displayName":"keyActivitiesAndServices","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"targetAudience","displayName":"targetAudience","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"numberOfStaff","displayName":"numberOfStaff","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":false},{"id":"staffRoles","displayName":"staffRoles","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"maxParticipants","displayName":"maxParticipants","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":false},{"id":"fundingSources","displayName":"fundingSources","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"evaluationImpactStrategy","displayName":"evaluationImpactStrategy","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"topPrioritiesOrChallenges","displayName":"topPrioritiesOrChallenges","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[3872,6576],"id":"01312640-e93f-4fc5-9134-0d7be7c406f5","name":"Airtable Logging3","credentials":{"airtableTokenApi":{"id":"T9wFFI0zQyNKM6on","name":"Jamshed's Airtable"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[2240,6576],"id":"1591e652-6132-475d-8b0f-a8a08f0ef4a3","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"xVx0pwYla0RbJEUC","name":"Jamshed's OpenAi account"}}},{"parameters":{"pineconeIndex":{"__rl":true,"value":"clienttesting","mode":"list","cachedResultName":"clienttesting"},"options":{"pineconeNamespace":"Sample Documents"}},"type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1.3,"position":[1856,6608],"id":"1d9230c6-3b9e-4b86-a9f3-f5a4297bdbfb","name":"Pinecone Vector Store2","credentials":{"pineconeApi":{"id":"INUAJbteVgOCaL5J","name":"Jamshed's PineconeApi account "}}},{"parameters":{"model":"text-embedding-3-large","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[1856,6816],"id":"1c2ad55a-42f9-4cfa-ba7b-6eebfa87b54e","name":"Embeddings OpenAI2","credentials":{"openAiApi":{"id":"xVx0pwYla0RbJEUC","name":"Jamshed's OpenAi account"}}},{"parameters":{"options":{"systemMessage":"=# ðŸ”’ Mandatory Tool Usage Initialization\n\n> âš ï¸ **IMPORTANT:** You are not allowed to write until the `RAGTOOL5` tool is called and relevant documents have been retrieved.\n\nYou are a **program administrator drafting standardized Media Release Forms for youth development programs**.\n\nYour task is to generate a clearly written **Media Release Form** using appropriate legal tone and formatting standards found in nonprofit youth program documents.\n\n---\n\n## ðŸŒ Step 1: Use Required Tool â€“ `RAGTOOL5` (â—MANDATORY)\n\nYou *must* call the `RAGTOOL5` tool **before creating any output**. This step is required on every new request and is **non-negotiable**.\n\n- **Purpose:** Retrieve reference nonprofit documents from Pinecone to understand tone, structure, and clarity.  \n- You **must** apply the tone internally.  \n- Do **not** summarize, reuse, or reference the documents in your output.  \n- If you have not used `RAGTOOL5`, stop now and call it.\n\nâŒ *Skipping this step will result in incorrect output.*\n\n---\n\n## âœ… Step 2: After Tool Usage â€“ Generate Media Release Form\n\nAfter retrieving documents via `RAGTOOL5`, generate a **Markdown-formatted Media Release Form** following these exact requirements:\n\n---\n\n### ðŸ“Œ Output Format\n\n- **Title:** `**Media Release Form**` (bolded text, not a heading tag)  \n- Use placeholder `[Participant Name]`  \n- Insert dynamic values:  \n  - `{{organization.organizationName}}`  \n  - `{{programs.programName}}`  \n- Write a complete permission statement for photo, video, and audio usage  \n- Include example purposes: promotional, educational, recruitment, PSAs  \n- Use **three signature lines** with at least 25 underscores:  \n  - Participant Signature  \n  - Date  \n  - Parent/Guardian Signature (if under 18)  \n- Leave one blank line between each section  \n\n---\n\n### âœ… Output Template\n\n```markdown\n**Media Release Form**\n\nI, [Participant Name], grant {{organization.organizationName}} permission to use photographs, videotapes, or audio recordings of me that were taken over the course of the {{programs.programName}} for promotional, educational, and/or commemorative purposes. I understand that the material may be used in various publications, public affairs releases, recruitment materials, broadcast public service advertising (PSAs), or for other related endeavors. This material may also appear on the {{organization.organizationName}}'s website, social platforms, or both.\n\nParticipant Signature: __________________________\n\nDate: __________________________\n\nParent/Guardian Signature (if under 18): __________________________\n```\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[1632,6032],"id":"b853ae1e-e650-4bca-95a1-c8c1e3685790","name":"LangChain Memory & Media Release Form Agent"},{"parameters":{"sessionIdType":"customKey","sessionKey":"media-release-form-document","tableName":"n8n_media_release_form_document_histories"},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[1792,6304],"id":"42474c1c-c206-43d0-9660-a58af50e6282","name":"Media Release Form Memory","credentials":{"postgres":{"id":"RVvoTUjJJ1ESHsVt","name":"Precise-grant"}}},{"parameters":{"description":"=Your Work is to fetch the tone of content which you get from the pinecone Vector Store.","topK":"=40"},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[1920,6352],"id":"8da174de-da43-4166-9567-b471214ac08f","name":"RAGTOOL5"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-288,5936],"id":"f8edea24-7e42-4b31-9869-ad81beb47305","name":"When clicking â€˜Execute workflowâ€™"}],"connections":{"Create Project Index":{"main":[[]]},"INTERNAL DOCUMENTS":{"main":[[]]},"PARTICIPANT-FACING DOCUMENTS":{"main":[[]]},"Download file":{"main":[[{"node":"Get Filename","type":"main","index":0}]]},"Google Drive Trigger":{"main":[[]]},"Set Namespace":{"main":[[{"node":"Get The Downloaded Files","type":"main","index":0}]]},"Get Filename":{"main":[[{"node":"Set Namespace","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Pinecone Vector Store","type":"ai_embedding","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Pinecone Vector Store","type":"ai_document","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Search files and folders":{"main":[[{"node":"Download file","type":"main","index":0}]]},"Get The Downloaded Files":{"main":[[{"node":"Pinecone Vector Store","type":"main","index":0}]]},"Download file1":{"main":[[{"node":"Get Filename1","type":"main","index":0}]]},"Set Namespace1":{"main":[[{"node":"Get The Downloaded Files1","type":"main","index":0}]]},"Get Filename1":{"main":[[{"node":"Set Namespace1","type":"main","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Pinecone Vector Store1","type":"ai_embedding","index":0}]]},"Default Data Loader1":{"ai_document":[[{"node":"Pinecone Vector Store1","type":"ai_document","index":0}]]},"Recursive Character Text Splitter1":{"ai_textSplitter":[[{"node":"Default Data Loader1","type":"ai_textSplitter","index":0}]]},"Search files and folders1":{"main":[[{"node":"Download file1","type":"main","index":0}]]},"Get The Downloaded Files1":{"main":[[{"node":"Pinecone Vector Store1","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"SOP Agent","type":"ai_languageModel","index":0}]]},"On form submission":{"main":[[]]},"Code2":{"main":[[]]},"Code3":{"main":[[{"node":"Code4","type":"main","index":0}]]},"HTTP Request":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Code4":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"SOP Agent":{"main":[[{"node":"Markdown","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"SOP Agent","type":"main","index":0}]]},"set_fields":{"main":[[{"node":"Prepare_Request","type":"main","index":0}]]},"Markdown":{"main":[[{"node":"set_fields","type":"main","index":0}]]},"Prepare_Request":{"main":[[{"node":"CreateGoogleDoc1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Roles & Responsibilities Matrix Agent","type":"ai_languageModel","index":0}]]},"Edit Fields1":{"main":[[{"node":"Code5","type":"main","index":0}]]},"Code5":{"main":[[{"node":"Roles & Responsibilities Matrix Agent","type":"main","index":0}]]},"set_fields1":{"main":[[{"node":"Prepare_Request1","type":"main","index":0}]]},"Markdown1":{"main":[[{"node":"Code6","type":"main","index":0}]]},"Prepare_Request1":{"main":[[{"node":"CreateGoogleDoc","type":"main","index":0}]]},"Roles & Responsibilities Matrix Agent":{"main":[[{"node":"Markdown1","type":"main","index":0}]]},"Code6":{"main":[[{"node":"set_fields1","type":"main","index":0}]]},"OpenAI Chat Model7":{"ai_languageModel":[[{"node":"LangChain Memory & Media Release Form Agent","type":"ai_languageModel","index":0}]]},"Sample Intake Data2":{"main":[[{"node":"Wrap Chat Input2","type":"main","index":0}]]},"Wrap Chat Input2":{"main":[[{"node":"LangChain Memory & Media Release Form Agent","type":"main","index":0}]]},"Convert Markdown to HTML2":{"main":[[{"node":"Set Document Metadata2","type":"main","index":0}]]},"Set Document Metadata2":{"main":[[{"node":"Build Google Docs Request2","type":"main","index":0}]]},"Build Google Docs Request2":{"main":[[{"node":"Upload Google Doc2","type":"main","index":0}]]},"Upload Google Doc2":{"main":[[{"node":"Airtable Logging3","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"RAGTOOL5","type":"ai_languageModel","index":0}]]},"Pinecone Vector Store2":{"ai_vectorStore":[[{"node":"RAGTOOL5","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI2":{"ai_embedding":[[{"node":"Pinecone Vector Store2","type":"ai_embedding","index":0}]]},"LangChain Memory & Media Release Form Agent":{"main":[[{"node":"Convert Markdown to HTML2","type":"main","index":0}]]},"Media Release Form Memory":{"ai_memory":[[{"node":"LangChain Memory & Media Release Form Agent","type":"ai_memory","index":0}]]},"RAGTOOL5":{"ai_tool":[[{"node":"LangChain Memory & Media Release Form Agent","type":"ai_tool","index":0}]]},"When clicking â€˜Execute workflowâ€™":{"main":[[{"node":"Sample Intake Data2","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"89c15281-1a52-49f5-ac5e-016f8787dc49","triggerCount":0,"tags":[]}